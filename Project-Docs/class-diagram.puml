@startuml
hide circle
skinparam classAttributeIconSize 0

' =========================
' ENUMS
' =========================
enum TipoItemRevisao {
  Peca
  Servico
}

enum ModeloMoto {
  FACTOR_125_i_UBS_2017_A_2025
  FACTOR_150_UBS_2016_A_2024
  NOVA_FACTOR_2025
  NOVA_FACTOR_DX_2025
  FAZER_150_UBS_2014_A_2025
  FZ15_2023_A_2024
  FAZER_FZ15_ABS_CONNECTED_2025_A_2026
  FAZER_250_2018_A_2024
  FZ25_CONNECTED_DE_2025_A_2026
  CROSSER_XTZ150_S_2015_A_2024
  CROSSER_XTZ150_S_2025
  CROSSER_XTZ150_Z_2015_A_2024
  CROSSER_XTZ150_Z_2025
  LANDER_250_2020_A_2024
  LANDER_250_ABS_CONNECTED_2025
  TENERE_700
  R15_ABS_2024_A_2026
  YZF_R3_ABS_2020_A_2025
  YZF_R3_ABS_CONNECTED_2026
  MT03_ABS_2021_A_2025
  NOVA_MT_03_CONNECTED_2026
  NOVA_MT_07_CONNECTED_2026
  NEO_125_2017_A_2024
  NEOS_DUAL_CONNECTED_2026
  FLUO_ABS_2022_A_2025
  FLUO_ABS_HYBRID_CONNECTED_2026
  AEROX_ABS_CONNECTED
  NMAX_CONNECTED_2023_A_2024
  NOVA_NMAX_CONNECTED_2025
  XMAX_2021_A_2024
  XMAX_CONNECTED_2025
  NOVA_XMAX_300_CONNECTED_2026
}

enum StatusRevisao {
  Pendente
  Agendada
  Executada
  Cancelada
}

' =========================
' AUTENTICAÇÃO
' =========================
class Usuario <<Model>> {
  +Email : string
  +SenhaHash : string
  +Ativo : bool

  --
  +AlterarSenha(novaSenha : string) : void
  +Desativar() : void
}

class AuthService <<Service>> {
  +CadastrarCliente(email : string, senha : string, cpf : string, nome : string) : Cliente
  +CadastrarConcessionaria(email : string, senha : string, cnpj : string, nome : string) : Concessionaria
  +Autenticar(email : string, senha : string) : Usuario
}

' =========================
' DOMÍNIO (MODELS)
' =========================
class Cliente <<Model>> {
  +Id : int
  +NomeProprietario : string
  +CPF : string
  +Email : string
  +Tel : string
  +Cel : string
  +Endereco : Endereco?
  +Motos : List<Moto>
}

class Concessionaria <<Model>> {
  +Id : int
  +NomeConcessionaria : string
  +CNPJ : string
  +Tel : string
  +Enderecos : List<Endereco>
  +Clientes : List<Cliente>
}

class Endereco <<Model>> {
  +Id : int
  +CEP : string
  +Rua : string
  +Numero : int
  +Bairro : string
  +Complemento : string

  --
  +Formatar() : string
  +DistanciaAte(outro : Endereco) : double
}

class Moto <<Model>> {
  +Id : int
  +Modelo : ModeloMoto
  +Placa : string
  +COR : string
  +NumeroChassi : string
  +DataDeVenda : DateTime
  +NotaFiscal : string
  +Serie : int
  +ImgDecalqueChassi : string
  +Revisoes : List<Revisao>

  --
  +ObterUltimaRevisaoExecutada() : Revisao?
  +ObterRevisao(numero : int) : Revisao?
}

class Revisao <<Model>> {
  +Id : int
  +Numero : int
  +Status : StatusRevisao

  +Cliente : Cliente
  +Moto : Moto
  +ConcessionariaResponsavel : Concessionaria?

  +DataAgendada : DateTime?
  +DataExecucao : DateTime?
  +KMAtual : int?

  +Itens : List<RevisaoItem>
  +ValorTotal : decimal
  +NotaDeServico : string

  --
  +Agendar(data : DateTime, concessionaria : Concessionaria) : void
  +GerarNotaDeServico() : string
  +Executar(dataExecucao : DateTime, kmAtual : int) : void

  ' (Opcional no escopo feliz; deixei comentado)
  ' +Reagendar(novaData : DateTime) : void
  ' +Cancelar(motivo : string) : void
}

class RevisaoItem <<Model>> {
  +Tipo : TipoItemRevisao
  +Descricao : string
  +Grupo : string?
  +Ordem : int
  +Valor : decimal?
}

' =========================
' CONFIGURAÇÃO GLOBAL (BANCO)
' =========================
class ConfiguracaoAgendamento <<Model>> {
  +KmToleranciaPercent : double
  +TempoToleranciaDias : int
  +AtualizadoEm : DateTime

  --
  +Atualizar(kmToleranciaPercent : double, tempoToleranciaDias : int) : void
}

class AlertaRevisao <<Model>> {
  +PlacaMoto : string
  +NumeroRevisao : int
  +Mensagem : string
  +EmAtraso : bool
}

' =========================
' REGRAS FIXAS (JSON)
' =========================
class RegraRevisao <<Model>> {
  +NumeroRevisao : int
  +KmAlvo : int
  +MesesAlvo : int
}

class RegraRevisaoProvider <<Provider>> {
  +Carregar() : void
  +Obter(numeroRevisao : int) : RegraRevisao
  +Listar() : List<RegraRevisao>
}

' =========================
' MANUAL DE REVISÕES (JSON)
' - Global e fixo
' - Usado SOMENTE quando a Moto é cadastrada
' - Retorna as revisões já com itens e valor total
' =========================
class ManualRevisoesProvider <<Provider>> {
  +Carregar() : void
  +ObterRevisoesPara(modelo : ModeloMoto) : List<Revisao>
}

' =========================
' SERVIÇOS (MVC/Application Services)
' =========================
class ClienteService <<Service>> {
  +AtualizarContato(tel : string, cel : string, email : string) : void

  ' Ao cadastrar moto, o sistema já cria TODAS as revisões (1..47)
  +CadastrarMoto(moto : Moto) : void

  +EditarMoto(placa : string, dados : Moto) : void
  +RemoverMoto(placa : string) : void
  +ConsultarProximasRevisoes() : List<AlertaRevisao>

  ' (Opcional: agendamento inicia pelo cliente, mas a confirmação é da concessionária)
  +SolicitarAgendamento(moto : Moto, numeroRevisao : int, dataDesejada : DateTime) : void
}

class ConcessionariaService <<Service>> {
  +AdicionarEndereco(endereco : Endereco) : void
  +EditarEndereco(id : int, endereco : Endereco) : void
  +RemoverEndereco(id : int) : void

  ' Confirma agendamento e cria vínculo cliente<->concessionária (sem método separado)
  +ConfirmarAgendamento(cliente : Cliente, moto : Moto, numeroRevisao : int, dataConfirmada : DateTime) : Revisao

  ' Executa 100% feliz: executa todos os itens, fecha e gera nota
  +ExecutarRevisao(moto : Moto, numeroRevisao : int, kmAtual : int, dataExecucao : DateTime) : Revisao
}

class AgendamentoService <<Service>> {
  +ValidarAgendamento(moto : Moto, numeroRevisao : int, data : DateTime, kmAtual : int?) : bool

  --
  +ObterBaseTempo(moto : Moto, numeroRevisao : int) : DateTime
  +GerarAlertas(cliente : Cliente) : List<AlertaRevisao>
  +ObterProximaRevisaoNumero(moto : Moto) : int

  ' AGORA: não cria revisão.
  ' Apenas opera sobre a revisão que já existe dentro da Moto.
  +Agendar(moto : Moto, numeroRevisao : int, concessionaria : Concessionaria, dataConfirmada : DateTime, kmAtual : int?) : Revisao
}

' =========================
' RELACIONAMENTOS (DOMÍNIO)
' =========================
Usuario "1" -- "0..1" Cliente
Usuario "1" -- "0..1" Concessionaria

Cliente "1" o-- "0..1" Endereco
Cliente "1" o-- "*" Moto

Concessionaria "*" -- "*" Cliente
Concessionaria "1" o-- "*" Endereco

Moto "1" o-- "*" Revisao
Revisao "1" o-- "*" RevisaoItem

' =========================
' DEPENDÊNCIAS (SERVIÇOS)
' =========================
ClienteService ..> Cliente
ClienteService ..> Moto
ClienteService ..> ManualRevisoesProvider
ClienteService ..> AgendamentoService
ClienteService ..> AlertaRevisao

ConcessionariaService ..> Concessionaria
ConcessionariaService ..> Cliente
ConcessionariaService ..> Endereco
ConcessionariaService ..> AgendamentoService
ConcessionariaService ..> Revisao

AgendamentoService ..> RegraRevisaoProvider
AgendamentoService ..> ConfiguracaoAgendamento
AgendamentoService ..> Revisao
AgendamentoService ..> Moto
AgendamentoService ..> Concessionaria
AgendamentoService ..> AlertaRevisao

AuthService ..> Usuario
AuthService ..> Cliente
AuthService ..> Concessionaria

@enduml